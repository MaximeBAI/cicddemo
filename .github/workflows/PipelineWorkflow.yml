name: Pipeline Workflow

on:
  workflow_dispatch:

jobs:
  build-publish-artifact:
    uses: ./.github/workflows/maven-build-publish-artifact.yml

  sonarqube-scan:
    uses: ./.github/workflows/ScanSonarGCP.yml
    with:
      sonar-token: ${{ secrets.SONAR_TOKEN }} # Pass the Sonar token as an input

    
  Add-sonar-tag:
    needs: [sonarqube-scan]
    uses: ./.github/workflows/addSonarTag.yml

  deploy-to-cloudhub:
    needs: [build-publish-artifact, sonarqube-scan]
    if: needs.build-publish-artifact.result == 'success' && needs.sonarcloud-scan.result == 'success'
    uses: ./.github/workflows/anypointCLI-deploy-cloudhub1.yml
    secrets: inherit
